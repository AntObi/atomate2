<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.03.27 -->
        <title>atomate2.vasp.sets.base - atomate2</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/github.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">atomate2</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">atomate2</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/running-workflows.html">Running Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/fireworks.html">Using atomate2 with FireWorks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../user/codes/index.html">Codes</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../user/codes/vasp.html">VASP</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference/atomate2.amset.html">atomate2.amset</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.amset.files.html">atomate2.amset.files</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.files.copy_amset_files.html">copy_amset_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.files.write_amset_settings.html">write_amset_settings</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.amset.jobs.html">atomate2.amset.jobs</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.jobs.AmsetMaker.html">AmsetMaker</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.amset.run.html">atomate2.amset.run</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.run.check_converged.html">check_converged</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.run.run_amset.html">run_amset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.run.tensor_average.html">tensor_average</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.amset.schemas.html">atomate2.amset.schemas</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.schemas.AmsetTaskDocument.html">AmsetTaskDocument</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.schemas.MeshData.html">MeshData</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.schemas.TransportData.html">TransportData</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.schemas.UsageStats.html">UsageStats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.amset.schemas.amset.html">amset</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.html">atomate2.common</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.analysis.html">atomate2.common.analysis</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.analysis.elastic.html">atomate2.common.analysis.elastic</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.analysis.elastic.get_default_strain_states.html">get_default_strain_states</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.files.html">atomate2.common.files</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.files.copy_files.html">copy_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.files.delete_files.html">delete_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.files.find_and_filter_files.html">find_and_filter_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.files.get_zfile.html">get_zfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.files.gunzip_files.html">gunzip_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.files.gzip_files.html">gzip_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.files.rename_files.html">rename_files</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.flows.html">atomate2.common.flows</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.flows.defect.html">atomate2.common.flows.defect</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.flows.defect.ConfigurationCoordinateMaker.html">ConfigurationCoordinateMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.flows.defect.DEFAULT_DISTORTIONS.html">DEFAULT_DISTORTIONS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.flows.defect.FormationEnergyMaker.html">FormationEnergyMaker</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.html">atomate2.common.jobs</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.html">atomate2.common.jobs.defect</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.bulk_supercell_calculation.html">bulk_supercell_calculation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.check_charge_state.html">check_charge_state</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.get_ccd_documents.html">get_ccd_documents</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.get_charged_structures.html">get_charged_structures</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.get_supercell_from_prv_calc.html">get_supercell_from_prv_calc</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.spawn_defect_q_jobs.html">spawn_defect_q_jobs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.spawn_energy_curve_calcs.html">spawn_energy_curve_calcs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.defect.CCDInput.html">CCDInput</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.utils.html">atomate2.common.jobs.utils</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.utils.retrieve_structure_from_materials_project.html">retrieve_structure_from_materials_project</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.utils.structure_to_conventional.html">structure_to_conventional</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.jobs.utils.structure_to_primitive.html">structure_to_primitive</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.html">atomate2.common.schemas</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.cclib.html">atomate2.common.schemas.cclib</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.cclib.cclib_calculate.html">cclib_calculate</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.cclib.TaskDocument.html">TaskDocument</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.defects.html">atomate2.common.schemas.defects</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.defects.get_dQ.html">get_dQ</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.defects.sort_pos_dist.html">sort_pos_dist</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.defects.CCDDocument.html">CCDDocument</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.defects.FormationEnergyDiagramDocument.html">FormationEnergyDiagramDocument</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.elastic.html">atomate2.common.schemas.elastic</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.elastic.DerivedProperties.html">DerivedProperties</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.elastic.ElasticDocument.html">ElasticDocument</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.elastic.ElasticTensorDocument.html">ElasticTensorDocument</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.common.schemas.elastic.FittingData.html">FittingData</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.common.utils.html">atomate2.common.utils</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.utils.get_transformations.html">get_transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.utils.parse_additional_json.html">parse_additional_json</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.utils.parse_custodian.html">parse_custodian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.common.utils.parse_transformations.html">parse_transformations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference/atomate2.lobster.html">atomate2.lobster</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.lobster.files.html">atomate2.lobster.files</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.files.copy_lobster_files.html">copy_lobster_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.files.LOBSTEROUTPUT_FILES.html">LOBSTEROUTPUT_FILES</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.files.VASP_OUTPUT_FILES.html">VASP_OUTPUT_FILES</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.lobster.jobs.html">atomate2.lobster.jobs</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.jobs.LobsterMaker.html">LobsterMaker</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.lobster.run.html">atomate2.lobster.run</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.run.run_lobster.html">run_lobster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.run.JobType.html">JobType</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.lobster.schemas.html">atomate2.lobster.schemas</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.schemas.CondensedBondingAnalysis.html">CondensedBondingAnalysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.schemas.LobsterTaskDocument.html">LobsterTaskDocument</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.schemas.LobsterinModel.html">LobsterinModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.schemas.LobsteroutModel.html">LobsteroutModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.lobster.schemas.StrongestBonds.html">StrongestBonds</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference/atomate2.settings.html">atomate2.settings</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference/atomate2.settings.Atomate2Settings.html">Atomate2Settings</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference/atomate2.utils.html">atomate2.utils</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.utils.datetime.html">atomate2.utils.datetime</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.datetime.datetime_str.html">datetime_str</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.utils.file_client.html">atomate2.utils.file_client</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.file_client.auto_fileclient.html">auto_fileclient</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.file_client.get_ssh_connection.html">get_ssh_connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.file_client.FileClient.html">FileClient</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.utils.log.html">atomate2.utils.log</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.log.initialize_logger.html">initialize_logger</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.utils.path.html">atomate2.utils.path</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.path.find_recent_logfile.html">find_recent_logfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.path.get_uri.html">get_uri</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.utils.path.strip_hostname.html">strip_hostname</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.html">atomate2.vasp</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.builders.html">atomate2.vasp.builders</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.builders.elastic.html">atomate2.vasp.builders.elastic</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.builders.elastic.ElasticBuilder.html">ElasticBuilder</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.drones.html">atomate2.vasp.drones</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.drones.VaspDrone.html">VaspDrone</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.files.html">atomate2.vasp.files</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.files.copy_vasp_outputs.html">copy_vasp_outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.files.get_largest_relax_extension.html">get_largest_relax_extension</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.files.write_vasp_input_set.html">write_vasp_input_set</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.html">atomate2.vasp.flows</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.amset.html">atomate2.vasp.flows.amset</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.amset.DeformationPotentialMaker.html">DeformationPotentialMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.amset.HSEVaspAmsetMaker.html">HSEVaspAmsetMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.amset.VaspAmsetMaker.html">VaspAmsetMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.html">atomate2.vasp.flows.core</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.BandStructureMaker.html">BandStructureMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.DoubleRelaxMaker.html">DoubleRelaxMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.HSEBandStructureMaker.html">HSEBandStructureMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.HSELineModeBandStructureMaker.html">HSELineModeBandStructureMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.HSEOpticsMaker.html">HSEOpticsMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.HSEUniformBandStructureMaker.html">HSEUniformBandStructureMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.LineModeBandStructureMaker.html">LineModeBandStructureMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.OpticsMaker.html">OpticsMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.RelaxBandStructureMaker.html">RelaxBandStructureMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.core.UniformBandStructureMaker.html">UniformBandStructureMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.defect.html">atomate2.vasp.flows.defect</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.defect.ConfigurationCoordinateMaker.html">ConfigurationCoordinateMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.defect.DEFECT_INCAR_SETTINGS.html">DEFECT_INCAR_SETTINGS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.defect.DEFECT_KPOINT_SETTINGS.html">DEFECT_KPOINT_SETTINGS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.defect.FormationEnergyMaker.html">FormationEnergyMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.defect.GRID_KEYS.html">GRID_KEYS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.defect.NonRadiativeMaker.html">NonRadiativeMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.elastic.html">atomate2.vasp.flows.elastic</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.elastic.ElasticMaker.html">ElasticMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.elph.html">atomate2.vasp.flows.elph</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.elph.DEFAULT_ELPH_TEMPERATURES.html">DEFAULT_ELPH_TEMPERATURES</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.elph.DEFAULT_MIN_SUPERCELL_LENGTH.html">DEFAULT_MIN_SUPERCELL_LENGTH</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.elph.ElectronPhononMaker.html">ElectronPhononMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.elph.HSEElectronPhononMaker.html">HSEElectronPhononMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.lobster.html">atomate2.vasp.flows.lobster</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.lobster.VaspLobsterMaker.html">VaspLobsterMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.phonons.html">atomate2.vasp.flows.phonons</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.flows.phonons.PhononMaker.html">PhononMaker</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.html">atomate2.vasp.jobs</a><input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" role="switch" type="checkbox"/><label for="toctree-checkbox-46"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.html">atomate2.vasp.jobs.amset</a><input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" role="switch" type="checkbox"/><label for="toctree-checkbox-47"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.calculate_deformation_potentials.html">calculate_deformation_potentials</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.calculate_polar_phonon_frequency.html">calculate_polar_phonon_frequency</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.generate_wavefunction_coefficients.html">generate_wavefunction_coefficients</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.run_amset_deformations.html">run_amset_deformations</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.DenseUniformMaker.html">DenseUniformMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.HSEDenseUniformMaker.html">HSEDenseUniformMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.HSEStaticDeformationMaker.html">HSEStaticDeformationMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.amset.StaticDeformationMaker.html">StaticDeformationMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.base.html">atomate2.vasp.jobs.base</a><input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" role="switch" type="checkbox"/><label for="toctree-checkbox-48"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.base.get_vasp_task_document.html">get_vasp_task_document</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.base.vasp_job.html">vasp_job</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.base.BaseVaspMaker.html">BaseVaspMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.html">atomate2.vasp.jobs.core</a><input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" role="switch" type="checkbox"/><label for="toctree-checkbox-49"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.DielectricMaker.html">DielectricMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.HSEBSMaker.html">HSEBSMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.HSERelaxMaker.html">HSERelaxMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.HSEStaticMaker.html">HSEStaticMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.HSETightRelaxMaker.html">HSETightRelaxMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.MDMaker.html">MDMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.NonSCFMaker.html">NonSCFMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.RelaxMaker.html">RelaxMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.StaticMaker.html">StaticMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.TightRelaxMaker.html">TightRelaxMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.core.TransmuterMaker.html">TransmuterMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.defect.html">atomate2.vasp.jobs.defect</a><input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" role="switch" type="checkbox"/><label for="toctree-checkbox-50"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.defect.calculate_finite_diff.html">calculate_finite_diff</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elastic.html">atomate2.vasp.jobs.elastic</a><input class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" role="switch" type="checkbox"/><label for="toctree-checkbox-51"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elastic.fit_elastic_tensor.html">fit_elastic_tensor</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elastic.generate_elastic_deformations.html">generate_elastic_deformations</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elastic.run_elastic_deformations.html">run_elastic_deformations</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elastic.ElasticRelaxMaker.html">ElasticRelaxMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elph.html">atomate2.vasp.jobs.elph</a><input class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" role="switch" type="checkbox"/><label for="toctree-checkbox-52"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elph.calculate_electron_phonon_renormalisation.html">calculate_electron_phonon_renormalisation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elph.run_elph_displacements.html">run_elph_displacements</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elph.DEFAULT_ELPH_TEMPERATURES.html">DEFAULT_ELPH_TEMPERATURES</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elph.DEFAULT_MIN_SUPERCELL_LENGTH.html">DEFAULT_MIN_SUPERCELL_LENGTH</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.elph.SupercellElectronPhononDisplacedStructureMaker.html">SupercellElectronPhononDisplacedStructureMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.lobster.html">atomate2.vasp.jobs.lobster</a><input class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" role="switch" type="checkbox"/><label for="toctree-checkbox-53"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.lobster.delete_lobster_wavecar.html">delete_lobster_wavecar</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.lobster.get_basis_infos.html">get_basis_infos</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.lobster.get_lobster_jobs.html">get_lobster_jobs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.lobster.update_user_incar_settings_maker.html">update_user_incar_settings_maker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.lobster.LobsterStaticMaker.html">LobsterStaticMaker</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.html">atomate2.vasp.jobs.phonons</a><input class="toctree-checkbox" id="toctree-checkbox-54" name="toctree-checkbox-54" role="switch" type="checkbox"/><label for="toctree-checkbox-54"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.generate_frequencies_eigenvectors.html">generate_frequencies_eigenvectors</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.generate_phonon_displacements.html">generate_phonon_displacements</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.get_supercell_size.html">get_supercell_size</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.get_total_energy_per_cell.html">get_total_energy_per_cell</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.run_phonon_displacements.html">run_phonon_displacements</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.PhononDisplacementMaker.html">PhononDisplacementMaker</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.jobs.phonons.VaspToTHz.html">VaspToTHz</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.powerups.html">atomate2.vasp.powerups</a><input class="toctree-checkbox" id="toctree-checkbox-55" name="toctree-checkbox-55" role="switch" type="checkbox"/><label for="toctree-checkbox-55"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.powerups.update_user_incar_settings.html">update_user_incar_settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.powerups.update_user_kpoints_settings.html">update_user_kpoints_settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.powerups.update_user_potcar_functional.html">update_user_potcar_functional</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.powerups.update_user_potcar_settings.html">update_user_potcar_settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.powerups.use_auto_ispin.html">use_auto_ispin</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.run.html">atomate2.vasp.run</a><input class="toctree-checkbox" id="toctree-checkbox-56" name="toctree-checkbox-56" role="switch" type="checkbox"/><label for="toctree-checkbox-56"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.run.run_vasp.html">run_vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.run.should_stop_children.html">should_stop_children</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference/atomate2.vasp.run.JobType.html">JobType</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.html">atomate2.vasp.schemas</a><input class="toctree-checkbox" id="toctree-checkbox-57" name="toctree-checkbox-57" role="switch" type="checkbox"/><label for="toctree-checkbox-57"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.html">atomate2.vasp.schemas.calc_types</a><input class="toctree-checkbox" id="toctree-checkbox-58" name="toctree-checkbox-58" role="switch" type="checkbox"/><label for="toctree-checkbox-58"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.enums.html">atomate2.vasp.schemas.calc_types.enums</a><input class="toctree-checkbox" id="toctree-checkbox-59" name="toctree-checkbox-59" role="switch" type="checkbox"/><label for="toctree-checkbox-59"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.enums.CalcType.html">CalcType</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.enums.RunType.html">RunType</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.enums.TaskType.html">TaskType</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.utils.html">atomate2.vasp.schemas.calc_types.utils</a><input class="toctree-checkbox" id="toctree-checkbox-60" name="toctree-checkbox-60" role="switch" type="checkbox"/><label for="toctree-checkbox-60"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.utils.calc_type.html">calc_type</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.utils.run_type.html">run_type</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.calc_types.utils.task_type.html">task_type</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.defect.html">atomate2.vasp.schemas.defect</a><input class="toctree-checkbox" id="toctree-checkbox-61" name="toctree-checkbox-61" role="switch" type="checkbox"/><label for="toctree-checkbox-61"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.defect.FiniteDifferenceDocument.html">FiniteDifferenceDocument</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.elph.html">atomate2.vasp.schemas.elph</a><input class="toctree-checkbox" id="toctree-checkbox-62" name="toctree-checkbox-62" role="switch" type="checkbox"/><label for="toctree-checkbox-62"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.elph.ElectronPhononRenormalisationDoc.html">ElectronPhononRenormalisationDoc</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.elph.RawElectronicData.html">RawElectronicData</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.phonons.html">atomate2.vasp.schemas.phonons</a><input class="toctree-checkbox" id="toctree-checkbox-63" name="toctree-checkbox-63" role="switch" type="checkbox"/><label for="toctree-checkbox-63"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.phonons.PhononBSDOSDoc.html">PhononBSDOSDoc</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.phonons.PhononComputationalSettings.html">PhononComputationalSettings</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.phonons.PhononJobDirs.html">PhononJobDirs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.phonons.PhononUUIDs.html">PhononUUIDs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.phonons.ThermalDisplacementData.html">ThermalDisplacementData</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.schemas.phonons.VaspToTHz.html">VaspToTHz</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.html">atomate2.vasp.sets</a><input class="toctree-checkbox" id="toctree-checkbox-64" name="toctree-checkbox-64" role="switch" type="checkbox"/><label for="toctree-checkbox-64"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.base.html">atomate2.vasp.sets.base</a><input class="toctree-checkbox" id="toctree-checkbox-65" name="toctree-checkbox-65" role="switch" type="checkbox"/><label for="toctree-checkbox-65"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.base.VaspInputGenerator.html">VaspInputGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.base.VaspInputSet.html">VaspInputSet</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.html">atomate2.vasp.sets.core</a><input class="toctree-checkbox" id="toctree-checkbox-66" name="toctree-checkbox-66" role="switch" type="checkbox"/><label for="toctree-checkbox-66"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.ElectronPhononSetGenerator.html">ElectronPhononSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.HSEBSSetGenerator.html">HSEBSSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.HSERelaxSetGenerator.html">HSERelaxSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.HSEStaticSetGenerator.html">HSEStaticSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.HSETightRelaxSetGenerator.html">HSETightRelaxSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.MDSetGenerator.html">MDSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.NonSCFSetGenerator.html">NonSCFSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.RelaxSetGenerator.html">RelaxSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.StaticSetGenerator.html">StaticSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.core.TightRelaxSetGenerator.html">TightRelaxSetGenerator</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.defect.html">atomate2.vasp.sets.defect</a><input class="toctree-checkbox" id="toctree-checkbox-67" name="toctree-checkbox-67" role="switch" type="checkbox"/><label for="toctree-checkbox-67"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.defect.ChargeStateRelaxSetGenerator.html">ChargeStateRelaxSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.defect.ChargeStateStaticSetGenerator.html">ChargeStateStaticSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.defect.HSEChargeStateRelaxSetGenerator.html">HSEChargeStateRelaxSetGenerator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../reference/atomate2.vasp.sets.defect.HSEChargeStateStaticSetGenerator.html">HSEChargeStateStaticSetGenerator</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/dev_install.html">Developer Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/vasp_tests.html">Writing VASP Tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/contributing.html">Contributing to atomate2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for atomate2.vasp.sets.base</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module defining base VASP input set and generator.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">monty.io</span> <span class="kn">import</span> <span class="n">zopen</span>
<span class="kn">from</span> <span class="nn">monty.serialization</span> <span class="kn">import</span> <span class="n">loadfn</span>
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">resource_filename</span>
<span class="kn">from</span> <span class="nn">pymatgen.core</span> <span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">pymatgen.electronic_structure.core</span> <span class="kn">import</span> <span class="n">Magmom</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.core</span> <span class="kn">import</span> <span class="n">InputGenerator</span><span class="p">,</span> <span class="n">InputSet</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp</span> <span class="kn">import</span> <span class="n">Incar</span><span class="p">,</span> <span class="n">Kpoints</span><span class="p">,</span> <span class="n">Outcar</span><span class="p">,</span> <span class="n">Poscar</span><span class="p">,</span> <span class="n">Potcar</span><span class="p">,</span> <span class="n">Vasprun</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp.sets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BadInputSetWarning</span><span class="p">,</span>
    <span class="n">get_valid_magmom_struct</span><span class="p">,</span>
    <span class="n">get_vasprun_outcar</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pymatgen.symmetry.analyzer</span> <span class="kn">import</span> <span class="n">SpacegroupAnalyzer</span>
<span class="kn">from</span> <span class="nn">pymatgen.symmetry.bandstructure</span> <span class="kn">import</span> <span class="n">HighSymmKpath</span>

<span class="kn">from</span> <span class="nn">atomate2</span> <span class="kn">import</span> <span class="n">SETTINGS</span>

<span class="n">_BASE_VASP_SET</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;atomate2.vasp.sets&quot;</span><span class="p">,</span> <span class="s2">&quot;BaseVaspSet.yaml&quot;</span><span class="p">))</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;VaspInputSet&quot;</span><span class="p">,</span> <span class="s2">&quot;VaspInputGenerator&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="VaspInputSet"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputSet.html#atomate2.vasp.sets.base.VaspInputSet">[docs]</a><span class="k">class</span> <span class="nc">VaspInputSet</span><span class="p">(</span><span class="n">InputSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a set of VASP inputs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    incar</span>
<span class="sd">        An Incar object.</span>
<span class="sd">    kpoints</span>
<span class="sd">        A Kpoints object.</span>
<span class="sd">    poscar</span>
<span class="sd">        A Poscar object.</span>
<span class="sd">    potcar</span>
<span class="sd">        A list of Potcar objects.</span>
<span class="sd">    optional_files</span>
<span class="sd">        Other input files supplied as a dict of ``{filename: object}``. The objects</span>
<span class="sd">        should follow standard pymatgen conventions in implementing an ``as_dict()``</span>
<span class="sd">        and ``from_dict`` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">incar</span><span class="p">:</span> <span class="n">Incar</span><span class="p">,</span>
        <span class="n">poscar</span><span class="p">:</span> <span class="n">Poscar</span><span class="p">,</span>
        <span class="n">potcar</span><span class="p">:</span> <span class="n">Potcar</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">kpoints</span><span class="p">:</span> <span class="n">Kpoints</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">optional_files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">incar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">poscar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span> <span class="o">=</span> <span class="n">potcar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">kpoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">optional_files</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">optional_files</span>

<div class="viewcode-block" id="VaspInputSet.write_input"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputSet.html#atomate2.vasp.sets.base.VaspInputSet.write_input">[docs]</a>    <span class="k">def</span> <span class="nf">write_input</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">make_dir</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">potcar_spec</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write VASP input files to a directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory</span>
<span class="sd">            Directory to write input files to.</span>
<span class="sd">        make_dir</span>
<span class="sd">            Whether to create the directory if it does not already exist.</span>
<span class="sd">        overwrite</span>
<span class="sd">            Whether to overwrite an input file if it already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">make_dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;INCAR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">,</span>
            <span class="s2">&quot;KPOINTS&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="p">,</span>
            <span class="s2">&quot;POSCAR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="p">,</span> <span class="n">Potcar</span><span class="p">):</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;POTCAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;POTCAR.spec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">overwrite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">directory</span> <span class="o">/</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
                <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">directory</span> <span class="o">/</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Poscar</span><span class="p">):</span>
                        <span class="c1"># write POSCAR with more significant figures</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">significant_figures</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="p">(</span><span class="n">directory</span> <span class="o">/</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">directory</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">k</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspInputSet.from_directory"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputSet.html#atomate2.vasp.sets.base.VaspInputSet.from_directory">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">optional_files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a set of VASP inputs from a directory.</span>

<span class="sd">        Note that only the standard INCAR, POSCAR, POTCAR and KPOINTS files are read</span>
<span class="sd">        unless optional_filenames is specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory</span>
<span class="sd">            Directory to read VASP inputs from.</span>
<span class="sd">        optional_files</span>
<span class="sd">            Optional files to read in as well as a dict of {filename: Object class}.</span>
<span class="sd">            Object class must have a static/class method from_file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;INCAR&quot;</span><span class="p">:</span> <span class="n">Incar</span><span class="p">,</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">:</span> <span class="n">Kpoints</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">:</span> <span class="n">Poscar</span><span class="p">,</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">:</span> <span class="n">Potcar</span><span class="p">}</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">directory</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">directory</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># handle the case where there is no KPOINTS file</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">optional_inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">optional_files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">optional_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">optional_inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">directory</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">VaspInputSet</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">optional_files</span><span class="o">=</span><span class="n">optional_inputs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether the input set is valid.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether the input set is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KSPACING&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Large KSPACING value detected with ISMEAR=-5. Ensure that VASP &quot;</span>
                <span class="s2">&quot;generates enough KPOINTS, lower KSPACING, or set ISMEAR=0&quot;</span><span class="p">,</span>
                <span class="n">BadInputSetWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">all</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">is_metal</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NSW&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>
        <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Relaxation of likely metal with ISMEAR &lt; 1 detected. Please see VASP &quot;</span>
                <span class="s2">&quot;recommendations on ISMEAR for metals.&quot;</span><span class="p">,</span>
                <span class="n">BadInputSetWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LHFCALC&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;ALGO&quot;</span><span class="p">,</span> <span class="s2">&quot;Normal&quot;</span>
        <span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;Normal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;All&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Damped&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Hybrid functionals only support Algo = All, Damped, or Normal.&quot;</span><span class="p">,</span>
                <span class="n">BadInputSetWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LASPH&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;METAGGA&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LHFCALC&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LDAU&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LUSE_VDW&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;LASPH = True should be set for +U, meta-GGAs, hybrids, and vdW-DFT&quot;</span><span class="p">,</span>
                <span class="n">BadInputSetWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="VaspInputGenerator"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputGenerator.html#atomate2.vasp.sets.base.VaspInputGenerator">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">VaspInputGenerator</span><span class="p">(</span><span class="n">InputGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to generate VASP input sets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    user_incar_settings</span>
<span class="sd">        User INCAR settings. This allows a user to override INCAR settings, e.g.,</span>
<span class="sd">        setting a different MAGMOM for various elements or species. The config_dict</span>
<span class="sd">        supports EDIFF_PER_ATOM and EDIFF keys. The former scales with # of atoms, the</span>
<span class="sd">        latter does not. If both are present, EDIFF is preferred. To force such</span>
<span class="sd">        settings, just supply user_incar_settings={&quot;EDIFF&quot;: 1e-5, &quot;LDAU&quot;: False} for</span>
<span class="sd">        example. The keys &#39;LDAUU&#39;, &#39;LDAUJ&#39;, &#39;LDAUL&#39; are special cases since pymatgen</span>
<span class="sd">        defines different values depending on what anions are present in the structure,</span>
<span class="sd">        so these keys can be defined in one of two ways, e.g. either</span>
<span class="sd">        {&quot;LDAUU&quot;:{&quot;O&quot;:{&quot;Fe&quot;:5}}} to set LDAUU for Fe to 5 in an oxide, or</span>
<span class="sd">        {&quot;LDAUU&quot;:{&quot;Fe&quot;:5}} to set LDAUU to 5 regardless of the input structure.</span>
<span class="sd">        If None is given, that key is unset. For example, {&quot;ENCUT&quot;: None} will remove</span>
<span class="sd">        ENCUT from the incar settings.</span>
<span class="sd">    user_kpoints_settings</span>
<span class="sd">        Allow user to override kpoints setting by supplying a dict. E.g.,</span>
<span class="sd">        ``{&quot;reciprocal_density&quot;: 1000}``. User can also supply a Kpoints object.</span>
<span class="sd">    user_potcar_settings</span>
<span class="sd">        Allow user to override POTCARs. E.g., {&quot;Gd&quot;: &quot;Gd_3&quot;}.</span>
<span class="sd">    user_potcar_functional</span>
<span class="sd">        Functional to use. Default is to use the functional in the config dictionary.</span>
<span class="sd">        Valid values: &quot;PBE&quot;, &quot;PBE_52&quot;, &quot;PBE_54&quot;, &quot;LDA&quot;, &quot;LDA_52&quot;, &quot;LDA_54&quot;, &quot;PW91&quot;,</span>
<span class="sd">        &quot;LDA_US&quot;, &quot;PW91_US&quot;.</span>
<span class="sd">    auto_metal_kpoints</span>
<span class="sd">        If true and the system is metallic, try and use ``reciprocal_density_metal``</span>
<span class="sd">        instead of ``reciprocal_density`` for metallic systems. Note, this only works</span>
<span class="sd">        when generating the input set from a previous VASP directory.</span>
<span class="sd">    auto_ismear</span>
<span class="sd">        If true, the values for ISMEAR and SIGMA will be set automatically depending</span>
<span class="sd">        on the bandgap of the system. If the bandgap is not known (e.g., there is no</span>
<span class="sd">        previous VASP directory) then ISMEAR=0 and SIGMA=0.2; if the bandgap is zero (a</span>
<span class="sd">        metallic system) then ISMEAR=2 and SIGMA=0.2; if the system is an insulator,</span>
<span class="sd">        then ISMEAR=-5 (tetrahedron smearing). Note, this only works when generating the</span>
<span class="sd">        input set from a previous VASP directory.</span>
<span class="sd">    constrain_total_magmom</span>
<span class="sd">        Whether to constrain the total magmom (NUPDOWN in INCAR) to be the sum of the</span>
<span class="sd">        initial MAGMOM guess for all species.</span>
<span class="sd">    validate_magmom</span>
<span class="sd">        Ensure that missing magmom values are filled in with the default value of 1.0.</span>
<span class="sd">    use_structure_charge</span>
<span class="sd">        If set to True, then the overall charge of the structure (``structure.charge``)</span>
<span class="sd">        is  used to set NELECT.</span>
<span class="sd">    sort_structure</span>
<span class="sd">        Whether to sort the structure (using the default sort order of</span>
<span class="sd">        electronegativity) before generating input files. Defaults to True, the behavior</span>
<span class="sd">        you would want most of the time. This ensures that similar atomic species are</span>
<span class="sd">        grouped together.</span>
<span class="sd">    force_gamma</span>
<span class="sd">        Force gamma centered kpoint generation.</span>
<span class="sd">    vdw</span>
<span class="sd">        Adds default parameters for van-der-Waals functionals supported by VASP to</span>
<span class="sd">        INCAR. Supported functionals are: DFT-D2, undamped DFT-D3, DFT-D3 with</span>
<span class="sd">        Becke-Jonson damping, Tkatchenko-Scheffler, Tkatchenko-Scheffler with iterative</span>
<span class="sd">        Hirshfeld partitioning, MBD@rSC, dDsC, Dion&#39;s vdW-DF, DF2, optPBE, optB88,</span>
<span class="sd">        optB86b and rVV10.</span>
<span class="sd">    symprec</span>
<span class="sd">        Tolerance for symmetry finding, used for line mode band structure k-points.</span>
<span class="sd">    auto_ispin</span>
<span class="sd">        If generating input set from a previous calculation, this controls whether</span>
<span class="sd">        to disable magnetisation (ISPIN = 1) if the absolute value of all magnetic</span>
<span class="sd">        moments are less than 0.02.</span>
<span class="sd">    auto_lreal</span>
<span class="sd">        If True, automatically use the VASP recommended LREAL based on cell size.</span>
<span class="sd">    config_dict</span>
<span class="sd">        The config dictionary to use containing the base input set settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">user_incar_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">user_kpoints_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Kpoints</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">user_potcar_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">user_potcar_functional</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">auto_metal_kpoints</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">auto_ismear</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">constrain_total_magmom</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">validate_magmom</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">use_structure_charge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">sort_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">force_gamma</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">symprec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">SETTINGS</span><span class="o">.</span><span class="n">SYMPREC</span>
    <span class="n">vdw</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">auto_ispin</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">auto_lreal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">config_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_BASE_VASP_SET</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post init formatting of arguments.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KSPACING&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_kpoints_settings</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;You have specified KSPACING and also supplied kpoints settings. &quot;</span>
                <span class="s2">&quot;KSPACING only has effect when there is no KPOINTS file. Since both &quot;</span>
                <span class="s2">&quot;settings were given, pymatgen will generate a KPOINTS file and ignore &quot;</span>
                <span class="s2">&quot;KSPACING. Remove the `user_kpoints_settings` argument to enable &quot;</span>
                <span class="s2">&quot;KSPACING.&quot;</span><span class="p">,</span>
                <span class="n">BadInputSetWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pymatgen.io.vasp.sets</span> <span class="kn">import</span> <span class="n">MODULE_DIR</span> <span class="k">as</span> <span class="n">PMG_SET_DIR</span>

            <span class="n">vdw_par</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="n">PMG_SET_DIR</span> <span class="o">/</span> <span class="s2">&quot;vdW_parameters.yaml&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vdw_par</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid or unsupported van-der-Waals functional. Supported &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;functionals are </span><span class="si">{</span><span class="n">vdw_par</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;INCAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vdw_par</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vdw</span><span class="p">])</span>

        <span class="c1"># read the POTCAR_FUNCTIONAL from the .yaml</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar_functional</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;POTCAR_FUNCTIONAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PS&quot;</span><span class="p">)</span>

        <span class="c1"># warn if a user is overriding POTCAR_FUNCTIONAL</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_potcar_functional</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_potcar_functional</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">potcar_functional</span>
        <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Overriding the POTCAR functional is generally not recommended &quot;</span>
                <span class="s2">&quot;as it can significantly affect the results of calculations and &quot;</span>
                <span class="s2">&quot;compatibility with other calculations done with the same input set. &quot;</span>
                <span class="s2">&quot;Note that some POTCAR symbols specified in the configuration file may &quot;</span>
                <span class="s2">&quot;not be available in the selected functional.&quot;</span><span class="p">,</span>
                <span class="n">BadInputSetWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potcar_functional</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_potcar_functional</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_potcar_settings</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Overriding POTCARs is generally not recommended as it can &quot;</span>
                <span class="s2">&quot;significantly affect the results of calculations and compatibility &quot;</span>
                <span class="s2">&quot;with other calculations done with the same input set. In many &quot;</span>
                <span class="s2">&quot;instances, it is better to write a subclass of a desired input set and&quot;</span>
                <span class="s2">&quot; override the POTCAR in the subclass to be explicit on the &quot;</span>
                <span class="s2">&quot;differences.&quot;</span><span class="p">,</span>
                <span class="n">BadInputSetWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_potcar_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;POTCAR&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

<div class="viewcode-block" id="VaspInputGenerator.get_input_set"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputGenerator.html#atomate2.vasp.sets.base.VaspInputGenerator.get_input_set">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_set</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prev_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">potcar_spec</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VaspInputSet</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a VASP input set.</span>

<span class="sd">        Note, if both ``structure`` and ``prev_dir`` are set, then the structure</span>
<span class="sd">        specified will be preferred over the final structure from the last VASP run.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure</span>
<span class="sd">            A structure.</span>
<span class="sd">        prev_dir</span>
<span class="sd">            A previous directory to generate the input set from.</span>
<span class="sd">        potcar_spec</span>
<span class="sd">            Instead of generating a Potcar object, use a list of potcar symbols. This</span>
<span class="sd">            will be written as a &quot;POTCAR.spec&quot; file. This is intended to help sharing an</span>
<span class="sd">            input set with people who might not have a license to specific Potcar files.</span>
<span class="sd">            Given a &quot;POTCAR.spec&quot;, the specific POTCAR file can be re-generated using</span>
<span class="sd">            pymatgen with the &quot;generate_potcar&quot; function in the pymatgen CLI.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        VaspInputSet</span>
<span class="sd">            A VASP input set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">structure</span><span class="p">,</span> <span class="n">prev_incar</span><span class="p">,</span> <span class="n">bandgap</span><span class="p">,</span> <span class="n">ispin</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">,</span> <span class="n">outcar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_previous</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span> <span class="n">prev_dir</span>
        <span class="p">)</span>
        <span class="n">incar_updates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_incar_updates</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="n">prev_incar</span><span class="o">=</span><span class="n">prev_incar</span><span class="p">,</span>
            <span class="n">bandgap</span><span class="o">=</span><span class="n">bandgap</span><span class="p">,</span>
            <span class="n">vasprun</span><span class="o">=</span><span class="n">vasprun</span><span class="p">,</span>
            <span class="n">outcar</span><span class="o">=</span><span class="n">outcar</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">kpoints_updates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kpoints_updates</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="n">prev_incar</span><span class="o">=</span><span class="n">prev_incar</span><span class="p">,</span>
            <span class="n">bandgap</span><span class="o">=</span><span class="n">bandgap</span><span class="p">,</span>
            <span class="n">vasprun</span><span class="o">=</span><span class="n">vasprun</span><span class="p">,</span>
            <span class="n">outcar</span><span class="o">=</span><span class="n">outcar</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">kspacing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kspacing</span><span class="p">(</span><span class="n">incar_updates</span><span class="p">)</span>
        <span class="n">kpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_kpoints</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">kpoints_updates</span><span class="p">,</span> <span class="n">kspacing</span><span class="p">,</span> <span class="n">bandgap</span><span class="p">)</span>
        <span class="n">incar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_incar</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="n">kpoints</span><span class="p">,</span>
            <span class="n">prev_incar</span><span class="p">,</span>
            <span class="n">incar_updates</span><span class="p">,</span>
            <span class="n">bandgap</span><span class="o">=</span><span class="n">bandgap</span><span class="p">,</span>
            <span class="n">ispin</span><span class="o">=</span><span class="n">ispin</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">VaspInputSet</span><span class="p">(</span>
            <span class="n">incar</span><span class="o">=</span><span class="n">incar</span><span class="p">,</span>
            <span class="n">kpoints</span><span class="o">=</span><span class="n">kpoints</span><span class="p">,</span>
            <span class="n">poscar</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">),</span>
            <span class="n">potcar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_potcar</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">potcar_spec</span><span class="o">=</span><span class="n">potcar_spec</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VaspInputGenerator.get_incar_updates"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputGenerator.html#atomate2.vasp.sets.base.VaspInputGenerator.get_incar_updates">[docs]</a>    <span class="k">def</span> <span class="nf">get_incar_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">prev_incar</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bandgap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">outcar</span><span class="p">:</span> <span class="n">Outcar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get updates to the INCAR for this calculation type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure</span>
<span class="sd">            A structure.</span>
<span class="sd">        prev_incar</span>
<span class="sd">            An incar from a previous calculation.</span>
<span class="sd">        bandgap</span>
<span class="sd">            The band gap.</span>
<span class="sd">        vasprun</span>
<span class="sd">            A vasprun from a previous calculation.</span>
<span class="sd">        outcar</span>
<span class="sd">            An outcar from a previous calculation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary of updates to apply.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="VaspInputGenerator.get_kpoints_updates"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputGenerator.html#atomate2.vasp.sets.base.VaspInputGenerator.get_kpoints_updates">[docs]</a>    <span class="k">def</span> <span class="nf">get_kpoints_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">prev_incar</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bandgap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">outcar</span><span class="p">:</span> <span class="n">Outcar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get updates to the kpoints configuration for this calculation type.</span>

<span class="sd">        Note, these updates will be ignored if the user has set user_kpoint_settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure</span>
<span class="sd">            A structure.</span>
<span class="sd">        prev_incar</span>
<span class="sd">            An incar from a previous calculation.</span>
<span class="sd">        bandgap</span>
<span class="sd">            The band gap.</span>
<span class="sd">        vasprun</span>
<span class="sd">            A vasprun from a previous calculation.</span>
<span class="sd">        outcar</span>
<span class="sd">            An outcar from a previous calculation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary of updates to apply to the KPOINTS config.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="VaspInputGenerator.get_nelect"><a class="viewcode-back" href="../../../../reference/atomate2.vasp.sets.base.VaspInputGenerator.html#atomate2.vasp.sets.base.VaspInputGenerator.get_nelect">[docs]</a>    <span class="k">def</span> <span class="nf">get_nelect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the default number of electrons for a given structure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure</span>
<span class="sd">            A structure.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Number of electrons for the structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">potcar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_potcar</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">potcar_spec</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">nelec</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">element</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">nelectrons</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">potcar</span><span class="p">}</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">element_composition</span>
        <span class="n">nelect</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">num_atoms</span> <span class="o">*</span> <span class="n">nelec</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">)]</span> <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">num_atoms</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_structure_charge</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nelect</span> <span class="o">-</span> <span class="n">structure</span><span class="o">.</span><span class="n">charge</span>

        <span class="k">return</span> <span class="n">nelect</span></div>

    <span class="k">def</span> <span class="nf">_get_previous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prev_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load previous calculation outputs and decide which structure to use.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prev_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either structure or prev_dir must be set.&quot;</span><span class="p">)</span>

        <span class="n">prev_incar</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">prev_structure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">vasprun</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">outcar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">bandgap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ispin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">prev_dir</span><span class="p">:</span>
            <span class="n">vasprun</span><span class="p">,</span> <span class="n">outcar</span> <span class="o">=</span> <span class="n">get_vasprun_outcar</span><span class="p">(</span><span class="n">prev_dir</span><span class="p">)</span>

            <span class="n">path_prev_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">prev_dir</span><span class="p">)</span>

            <span class="c1"># CONTCAR is already renamed POSCAR</span>
            <span class="n">contcars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path_prev_dir</span> <span class="o">/</span> <span class="s2">&quot;POSCAR*&quot;</span><span class="p">)))</span>
            <span class="n">contcarfile_fullpath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path_prev_dir</span> <span class="o">/</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
            <span class="n">contcarfile</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">contcarfile_fullpath</span>
                <span class="k">if</span> <span class="n">contcarfile_fullpath</span> <span class="ow">in</span> <span class="n">contcars</span>
                <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">contcars</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">contcar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">contcarfile</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">efermi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># VASP doesn&#39;t output efermi in vasprun if IBRION = 1</span>
                <span class="n">vasprun</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="n">outcar</span><span class="o">.</span><span class="n">efermi</span>

            <span class="n">bs</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">get_band_structure</span><span class="p">(</span><span class="n">efermi</span><span class="o">=</span><span class="s2">&quot;smart&quot;</span><span class="p">)</span>
            <span class="n">prev_incar</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">incar</span>
            <span class="c1"># use structure from CONTCAR as it is written to greater</span>
            <span class="c1"># precision than in the vasprun</span>
            <span class="n">prev_structure</span> <span class="o">=</span> <span class="n">contcar</span><span class="o">.</span><span class="n">structure</span>
            <span class="n">bandgap</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">bs</span><span class="o">.</span><span class="n">is_metal</span><span class="p">()</span> <span class="k">else</span> <span class="n">bs</span><span class="o">.</span><span class="n">get_band_gap</span><span class="p">()[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_ispin</span><span class="p">:</span>
                <span class="c1"># turn off spin when magmom for every site is smaller than 0.02.</span>
                <span class="n">ispin</span> <span class="o">=</span> <span class="n">_get_ispin</span><span class="p">(</span><span class="n">vasprun</span><span class="p">,</span> <span class="n">outcar</span><span class="p">)</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span> <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prev_structure</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">structure</span><span class="p">,</span> <span class="n">prev_incar</span><span class="p">,</span> <span class="n">bandgap</span><span class="p">,</span> <span class="n">ispin</span><span class="p">,</span> <span class="n">vasprun</span><span class="p">,</span> <span class="n">outcar</span>

    <span class="k">def</span> <span class="nf">_get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the standardized structure.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;magmom&quot;</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">properties</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">site</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;magmom&quot;</span><span class="p">],</span> <span class="n">Magmom</span>
            <span class="p">):</span>
                <span class="c1"># required to fix bug in get_valid_magmom_struct</span>
                <span class="n">site</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;magmom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;magmom&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_structure</span><span class="p">:</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">get_sorted_structure</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_magmom</span><span class="p">:</span>
            <span class="n">get_valid_magmom_struct</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">spin_mode</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">structure</span>

    <span class="k">def</span> <span class="nf">_get_potcar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">potcar_spec</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the POTCAR.&quot;&quot;&quot;</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">])]</span>
        <span class="n">potcar_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;POTCAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">potcar_spec</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">potcar_symbols</span>

        <span class="n">potcar</span> <span class="o">=</span> <span class="n">Potcar</span><span class="p">(</span><span class="n">potcar_symbols</span><span class="p">,</span> <span class="n">functional</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_functional</span><span class="p">)</span>

        <span class="c1"># warn if the selected POTCARs do not correspond to the chosen potcar_functional</span>
        <span class="k">for</span> <span class="n">psingle</span> <span class="ow">in</span> <span class="n">potcar</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potcar_functional</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">psingle</span><span class="o">.</span><span class="n">identify_potcar</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;POTCAR data with symbol </span><span class="si">{</span><span class="n">psingle</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2"> is not known by pymatgen&quot;</span>
                    <span class="s2">&quot; to correspond with the selected potcar_functional &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_functional</span><span class="si">}</span><span class="s2">. This POTCAR is known to correspond with&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; functionals </span><span class="si">{</span><span class="n">psingle</span><span class="o">.</span><span class="n">identify_potcar</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">. Please &quot;</span>
                    <span class="s2">&quot;verify that you are using the right POTCARs!&quot;</span><span class="p">,</span>
                    <span class="n">BadInputSetWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">potcar</span>

    <span class="k">def</span> <span class="nf">_get_incar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">,</span>
        <span class="n">kpoints</span><span class="p">:</span> <span class="n">Kpoints</span><span class="p">,</span>
        <span class="n">previous_incar</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">incar_updates</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bandgap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ispin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the INCAR.&quot;&quot;&quot;</span>
        <span class="n">previous_incar</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">previous_incar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">previous_incar</span>
        <span class="n">incar_updates</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">incar_updates</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">incar_updates</span>
        <span class="n">incar_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;INCAR&quot;</span><span class="p">])</span>

        <span class="c1"># apply user incar settings to SETTINGS not to INCAR</span>
        <span class="n">_apply_incar_updates</span><span class="p">(</span><span class="n">incar_settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="p">)</span>

        <span class="c1"># generate incar</span>
        <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">incar_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;MAGMOM&quot;</span><span class="p">:</span>
                <span class="n">incar</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_magmoms</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;LDAUU&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUL&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">incar_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LDAU&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">incar</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_u_param</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;EDIFF&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;EDIFFG&quot;</span><span class="p">:</span>
                <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;EDIFF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_ediff</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">incar_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">incar</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">_set_u_params</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span> <span class="n">incar_settings</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>

        <span class="c1"># apply previous incar settings, be careful not to override user_incar_settings</span>
        <span class="c1"># also skip LDAU/MAGMOM as structure may have changed.</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">skip</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">,</span> <span class="s2">&quot;NUPDOWN&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUU&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUL&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span> <span class="s2">&quot;LMAXMIX&quot;</span><span class="p">]</span>
        <span class="n">_apply_incar_updates</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span> <span class="n">previous_incar</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrain_total_magmom</span><span class="p">:</span>
            <span class="n">nupdown</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mag</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">mag</span> <span class="ow">in</span> <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nupdown</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="n">nupdown</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-5</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;constrain_total_magmom was set to True, but the sum of MAGMOM &quot;</span>
                    <span class="s2">&quot;values is not an integer. NUPDOWN is meant to set the spin &quot;</span>
                    <span class="s2">&quot;multiplet and should typically be an integer. You are likely &quot;</span>
                    <span class="s2">&quot;better off changing the values of MAGMOM or simply setting &quot;</span>
                    <span class="s2">&quot;NUPDOWN directly in your INCAR settings.&quot;</span><span class="p">,</span>
                    <span class="ne">UserWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NUPDOWN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nupdown</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_structure_charge</span><span class="p">:</span>
            <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NELECT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nelect</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

        <span class="c1"># handle auto ISPIN</span>
        <span class="k">if</span> <span class="n">ispin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;ISPIN&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="p">:</span>
            <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISPIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ispin</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_ismear</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bandgap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># don&#39;t know if we are a metal or insulator so set ISMEAR and SIGMA to</span>
                <span class="c1"># be safe with the most general settings</span>
                <span class="n">incar</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;SIGMA&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;ISMEAR&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">bandgap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">incar</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;SIGMA&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;ISMEAR&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>  <span class="c1"># metal</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">incar</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;SIGMA&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">})</span>  <span class="c1"># insulator</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_lreal</span><span class="p">:</span>
            <span class="n">incar</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;LREAL&quot;</span><span class="p">:</span> <span class="n">_get_recommended_lreal</span><span class="p">(</span><span class="n">structure</span><span class="p">)})</span>

        <span class="k">if</span> <span class="n">kpoints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># unset KSPACING as we are using a KPOINTS file and ensure adequate number</span>
            <span class="c1"># of KPOINTS are present for the tetrahedron method (ISMEAR=-5).</span>
            <span class="n">incar</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;KSPACING&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">kpoints</span><span class="o">.</span><span class="n">kpts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># apply specified updates, be careful not to override user_incar_settings</span>
        <span class="n">_apply_incar_updates</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span> <span class="n">incar_updates</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Remove unused INCAR parameters</span>
        <span class="n">_remove_unused_incar_params</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">incar</span>

    <span class="k">def</span> <span class="nf">_get_kpoints</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">kpoints_updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kspacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bandgap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Kpoints</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the kpoints file.&quot;&quot;&quot;</span>
        <span class="n">kpoints_updates</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">kpoints_updates</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kpoints_updates</span>

        <span class="c1"># use user setting if set otherwise default to base config settings</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_kpoints_settings</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="n">kconfig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_kpoints_settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># apply updates to k-points config</span>
            <span class="n">kconfig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KPOINTS&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="n">kconfig</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kpoints_updates</span><span class="p">)</span>

        <span class="c1"># Return None if KSPACING is set and no other user k-points settings have been</span>
        <span class="c1"># specified, because this will cause VASP to generate the kpoints automatically</span>
        <span class="k">if</span> <span class="n">kspacing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_kpoints_settings</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kconfig</span><span class="p">,</span> <span class="n">Kpoints</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">kconfig</span>

        <span class="n">explicit</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;explicit&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;added_kpoints&quot;</span><span class="p">,</span> <span class="p">[]))</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="s2">&quot;zero_weighted_reciprocal_density&quot;</span> <span class="ow">in</span> <span class="n">kconfig</span>
            <span class="ow">or</span> <span class="s2">&quot;zero_weighted_line_density&quot;</span> <span class="ow">in</span> <span class="n">kconfig</span>
        <span class="p">)</span>
        <span class="c1"># handle length generation first as this doesn&#39;t support any additional options</span>
        <span class="k">if</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">explicit</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;length option cannot be used with explicit k-point generation, &quot;</span>
                    <span class="s2">&quot;added_kpoints, or zero weighted k-points.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># If length is in kpoints settings use Kpoints.automatic</span>
            <span class="k">return</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">automatic</span><span class="p">(</span><span class="n">kconfig</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">])</span>

        <span class="n">base_kpoints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line_density&quot;</span><span class="p">):</span>
            <span class="c1"># handle line density generation</span>
            <span class="n">kpath</span> <span class="o">=</span> <span class="n">HighSymmKpath</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kpath_kwargs&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="n">frac_k_points</span><span class="p">,</span> <span class="n">k_points_labels</span> <span class="o">=</span> <span class="n">kpath</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span>
                <span class="n">line_density</span><span class="o">=</span><span class="n">kconfig</span><span class="p">[</span><span class="s2">&quot;line_density&quot;</span><span class="p">],</span> <span class="n">coords_are_cartesian</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">base_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">(</span>
                <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Non SCF run along symmetry lines&quot;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">,</span>
                <span class="n">num_kpts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">frac_k_points</span><span class="p">),</span>
                <span class="n">kpts</span><span class="o">=</span><span class="n">frac_k_points</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">k_points_labels</span><span class="p">,</span>
                <span class="n">kpts_weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frac_k_points</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_density&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reciprocal_density&quot;</span><span class="p">):</span>
            <span class="c1"># handle regular weighted k-point grid generation</span>
            <span class="k">if</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_density&quot;</span><span class="p">):</span>
                <span class="n">base_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">automatic_density</span><span class="p">(</span>
                    <span class="n">structure</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">kconfig</span><span class="p">[</span><span class="s2">&quot;grid_density&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_gamma</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reciprocal_density&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">bandgap</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reciprocal_density_metal&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_metal_kpoints</span>
                <span class="p">):</span>
                    <span class="n">density</span> <span class="o">=</span> <span class="n">kconfig</span><span class="p">[</span><span class="s2">&quot;reciprocal_density_metal&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">density</span> <span class="o">=</span> <span class="n">kconfig</span><span class="p">[</span><span class="s2">&quot;reciprocal_density&quot;</span><span class="p">]</span>
                <span class="n">base_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">automatic_density_by_vol</span><span class="p">(</span>
                    <span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_gamma</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">explicit</span><span class="p">:</span>
                <span class="n">sga</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symprec</span><span class="p">)</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="n">sga</span><span class="o">.</span><span class="n">get_ir_reciprocal_mesh</span><span class="p">(</span><span class="n">base_kpoints</span><span class="o">.</span><span class="n">kpts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">base_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">(</span>
                    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Uniform grid&quot;</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">,</span>
                    <span class="n">num_kpts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">),</span>
                    <span class="n">kpts</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mesh</span><span class="p">],</span>
                    <span class="n">kpts_weights</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mesh</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if not explicit that means no other options have been specified</span>
                <span class="c1"># so we can return the k-points as is</span>
                <span class="k">return</span> <span class="n">base_kpoints</span>

        <span class="n">zero_weighted_kpoints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;zero_weighted_line_density&quot;</span><span class="p">):</span>
            <span class="c1"># zero_weighted k-points along line mode path</span>
            <span class="n">kpath</span> <span class="o">=</span> <span class="n">HighSymmKpath</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
            <span class="n">frac_k_points</span><span class="p">,</span> <span class="n">k_points_labels</span> <span class="o">=</span> <span class="n">kpath</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span>
                <span class="n">line_density</span><span class="o">=</span><span class="n">kconfig</span><span class="p">[</span><span class="s2">&quot;zero_weighted_line_density&quot;</span><span class="p">],</span>
                <span class="n">coords_are_cartesian</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">zero_weighted_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">(</span>
                <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Hybrid run along symmetry lines&quot;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">,</span>
                <span class="n">num_kpts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">frac_k_points</span><span class="p">),</span>
                <span class="n">kpts</span><span class="o">=</span><span class="n">frac_k_points</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">k_points_labels</span><span class="p">,</span>
                <span class="n">kpts_weights</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frac_k_points</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;zero_weighted_reciprocal_density&quot;</span><span class="p">):</span>
            <span class="n">zero_weighted_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">automatic_density_by_vol</span><span class="p">(</span>
                <span class="n">structure</span><span class="p">,</span> <span class="n">kconfig</span><span class="p">[</span><span class="s2">&quot;zero_weighted_reciprocal_density&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_gamma</span>
            <span class="p">)</span>
            <span class="n">sga</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symprec</span><span class="p">)</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">sga</span><span class="o">.</span><span class="n">get_ir_reciprocal_mesh</span><span class="p">(</span><span class="n">zero_weighted_kpoints</span><span class="o">.</span><span class="n">kpts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">zero_weighted_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">(</span>
                <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Uniform grid&quot;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">,</span>
                <span class="n">num_kpts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">),</span>
                <span class="n">kpts</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mesh</span><span class="p">],</span>
                <span class="n">kpts_weights</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mesh</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="n">added_kpoints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;added_kpoints&quot;</span><span class="p">):</span>
            <span class="n">added_kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">(</span>
                <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Specified k-points only&quot;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">,</span>
                <span class="n">num_kpts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;added_kpoints&quot;</span><span class="p">)),</span>
                <span class="n">kpts</span><span class="o">=</span><span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;added_kpoints&quot;</span><span class="p">),</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;user-defined&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;added_kpoints&quot;</span><span class="p">)),</span>
                <span class="n">kpts_weights</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">kconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;added_kpoints&quot;</span><span class="p">)),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">base_kpoints</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">added_kpoints</span> <span class="ow">or</span> <span class="n">zero_weighted_kpoints</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">base_kpoints</span>
        <span class="k">elif</span> <span class="n">added_kpoints</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">base_kpoints</span> <span class="ow">or</span> <span class="n">zero_weighted_kpoints</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">added_kpoints</span>

        <span class="c1"># do some sanity checking</span>
        <span class="k">if</span> <span class="s2">&quot;line_density&quot;</span> <span class="ow">in</span> <span class="n">kconfig</span> <span class="ow">and</span> <span class="n">zero_weighted_kpoints</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combined line_density and zero weighted k-points options&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">zero_weighted_kpoints</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">base_kpoints</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Zero weighted k-points must be used with reciprocal_density or &quot;</span>
                <span class="s2">&quot;grid_density options&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">base_kpoints</span> <span class="ow">or</span> <span class="n">zero_weighted_kpoints</span> <span class="ow">or</span> <span class="n">added_kpoints</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid k-point generation algo. Supported Keys are &#39;grid_density&#39; &quot;</span>
                <span class="s2">&quot;for Kpoints.automatic_density generation, &#39;reciprocal_density&#39; for &quot;</span>
                <span class="s2">&quot;KPoints.automatic_density_by_vol generation, &#39;length&#39; for &quot;</span>
                <span class="s2">&quot;Kpoints.automatic generation, &#39;line_density&#39; for line mode generation,&quot;</span>
                <span class="s2">&quot; &#39;added_kpoints&#39; for specific k-points to include, &quot;</span>
                <span class="s2">&quot; &#39;zero_weighted_reciprocal_density&#39; for a zero weighted uniform mesh,&quot;</span>
                <span class="s2">&quot; or &#39;zero_weighted_line_density&#39; for a zero weighted line mode mesh.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">_combine_kpoints</span><span class="p">(</span><span class="n">base_kpoints</span><span class="p">,</span> <span class="n">zero_weighted_kpoints</span><span class="p">,</span> <span class="n">added_kpoints</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_kspacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incar_updates</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get KSPACING value based on the config dict, updates and user settings.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;KSPACING&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_incar_settings</span><span class="p">[</span><span class="s2">&quot;KSPACING&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;KSPACING&quot;</span> <span class="ow">in</span> <span class="n">incar_updates</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">incar_updates</span><span class="p">[</span><span class="s2">&quot;KSPACING&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;KSPACING&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;INCAR&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;INCAR&quot;</span><span class="p">][</span><span class="s2">&quot;KSPACING&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="k">def</span> <span class="nf">_get_magmoms</span><span class="p">(</span><span class="n">magmoms</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the mamgoms.&quot;&quot;&quot;</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Co without an oxidation state is initialized as low spin by default in &quot;</span>
        <span class="s2">&quot;Atomate2. If this default behavior is not desired, please set the spin on the &quot;</span>
        <span class="s2">&quot;magmom on the site directly to ensure correct initialization.&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="s2">&quot;magmom&quot;</span><span class="p">):</span>
            <span class="n">mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">):</span>
            <span class="n">mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">)</span> <span class="ow">in</span> <span class="n">magmoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;Co&quot;</span> <span class="ow">and</span> <span class="n">magmoms</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">)]</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">magmoms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;Co&quot;</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">magmoms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mag</span>


<span class="k">def</span> <span class="nf">_get_u_param</span><span class="p">(</span><span class="n">lda_param</span><span class="p">,</span> <span class="n">lda_config</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get U parameters.&quot;&quot;&quot;</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">elements</span> <span class="k">if</span> <span class="n">comp</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
    <span class="n">most_electroneg</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span>
    <span class="n">poscar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">structure</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lda_param</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">lda_param</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">poscar</span><span class="o">.</span><span class="n">site_symbols</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lda_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">most_electroneg</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># lookup specific LDAU if specified for most_electroneg atom</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">lda_config</span><span class="p">[</span><span class="n">most_electroneg</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">poscar</span><span class="o">.</span><span class="n">site_symbols</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">lda_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lda_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">else</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">poscar</span><span class="o">.</span><span class="n">site_symbols</span>
        <span class="p">]</span>


<span class="k">def</span> <span class="nf">_get_ediff</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">incar_settings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get EDIFF.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">incar_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EDIFF&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;EDIFF_PER_ATOM&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">incar_settings</span><span class="p">[</span><span class="s2">&quot;EDIFF&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_set_u_params</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span> <span class="n">incar_settings</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Modify INCAR for use with U parameters.&quot;&quot;&quot;</span>
    <span class="n">has_u</span> <span class="o">=</span> <span class="n">incar_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LDAU&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDAUU&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_u</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">incar</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;LDAU&quot;</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">incar</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Modify LMAXMIX if you have d or f electrons present. Note that if the user</span>
    <span class="c1"># explicitly sets LMAXMIX in settings it will override this logic. Previously, this</span>
    <span class="c1"># was only set if Hubbard U was enabled as per the VASP manual but following an</span>
    <span class="c1"># investigation it was determined that this would lead to a significant difference</span>
    <span class="c1"># between SCF -&gt; NonSCF even without Hubbard U enabled. Thanks to Andrew Rosen for</span>
    <span class="c1"># investigating and reporting.</span>
    <span class="k">if</span> <span class="s2">&quot;LMAXMIX&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">incar_settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># contains f-electrons</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">56</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
            <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LMAXMIX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="c1"># contains d-electrons</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
            <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LMAXMIX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">_apply_incar_updates</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span> <span class="n">updates</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply updates to an INCAR file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    incar</span>
<span class="sd">        An incar.</span>
<span class="sd">    updates</span>
<span class="sd">        Updates to apply.</span>
<span class="sd">    skip</span>
<span class="sd">        Keys to skip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">skip</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">skip</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">skip</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">updates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">incar</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">incar</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>


<span class="k">def</span> <span class="nf">_remove_unused_incar_params</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove INCAR parameters that are not actively used by VASP.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    incar</span>
<span class="sd">        An incar.</span>
<span class="sd">    skip</span>
<span class="sd">        Keys to skip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">skip</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">skip</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">skip</span>

    <span class="c1"># Turn off IBRION/ISIF/POTIM if NSW = 0</span>
    <span class="n">opt_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EDIFFG&quot;</span><span class="p">,</span> <span class="s2">&quot;IBRION&quot;</span><span class="p">,</span> <span class="s2">&quot;ISIF&quot;</span><span class="p">,</span> <span class="s2">&quot;POTIM&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NSW&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">opt_flag</span> <span class="ow">in</span> <span class="n">opt_flags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opt_flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
                <span class="n">incar</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">opt_flag</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Remove MAGMOMs if they aren&#39;t used</span>
    <span class="k">if</span> <span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ISPIN&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s2">&quot;MAGMOM&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
        <span class="n">incar</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Turn off +U flags if +U is not even used</span>
    <span class="n">ldau_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LDAUU&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUL&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LDAU&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ldau_flag</span> <span class="ow">in</span> <span class="n">ldau_flags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ldau_flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
                <span class="n">incar</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ldau_flag</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_combine_kpoints</span><span class="p">(</span><span class="o">*</span><span class="n">kpoints_objects</span><span class="p">:</span> <span class="n">Kpoints</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine k-points files together.&quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">kpoints_object</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">kpoints_objects</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kpoints_object</span><span class="o">.</span><span class="n">style</span> <span class="o">==</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can only combine kpoints with style=Kpoints.supported_modes.Reciprocal&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">kpoints_object</span><span class="o">.</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">kpoints_object</span><span class="o">.</span><span class="n">kpts</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpoints_object</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpoints_object</span><span class="o">.</span><span class="n">kpts_weights</span><span class="p">)</span>
        <span class="n">kpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpoints_object</span><span class="o">.</span><span class="n">kpts</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">kpoints</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Combined k-points&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">,</span>
        <span class="n">num_kpts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">kpoints</span><span class="p">),</span>
        <span class="n">kpts</span><span class="o">=</span><span class="n">kpoints</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">kpts_weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_ispin</span><span class="p">(</span><span class="n">vasprun</span><span class="p">:</span> <span class="n">Vasprun</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">outcar</span><span class="p">:</span> <span class="n">Outcar</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get value of ISPIN depending on the magnetisation in the OUTCAR and vasprun.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">outcar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcar</span><span class="o">.</span><span class="n">magnetization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Turn off spin when magmom for every site is smaller than 0.02.</span>
        <span class="n">site_magmom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;tot&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outcar</span><span class="o">.</span><span class="n">magnetization</span><span class="p">])</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">site_magmom</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.02</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">vasprun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">is_spin</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">_get_recommended_lreal</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get recommended LREAL flag based on the structure.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Auto&quot;</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, materialsproject
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/materialsproject/atomate2" aria-label="GitHub">
<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
</svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/scripts/furo.js"></script>
    <script src="../../../../_static/design-tabs.js"></script>
    </body>
</html>