
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Installation &#8212; atomate2</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running Workflows" href="running-workflows.html" />
    <link rel="prev" title="User Guide" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">atomate2</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../reference/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../dev/index.html">
  Developer Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://matsci.org/c/atomate">
  Support
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/materialsproject/atomate2" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="running-workflows.html">
   Running workflows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="fireworks.html">
   Fireworks integration
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="codes/index.html">
   Codes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="codes/vasp.html">
     VASP
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Change log
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="contributors.html">
   Contributors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   Contributing to atomate2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="license.html">
   License
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#objectives">
     Objectives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation-checklist">
     Installation checklist
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prerequisites">
   Prerequisites
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vasp">
     VASP
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mongodb">
     MongoDB
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-directory-scaffold-for-atomate2">
   Create a directory scaffold for atomate2
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-conda-environment">
   Create a conda environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-python-packages">
   Install Python packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-calculation-output-database">
   Configure calculation output database
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jobflow-yaml">
     jobflow.yaml
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomate2-yaml">
     atomate2.yaml
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finishing-up">
     Finishing up
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-pymatgen">
   Configure pymatgen
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pseudopotentials">
     Pseudopotentials
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#materials-project-api-key">
     Materials Project API key
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-a-test-workflow">
   Run a test workflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-workflow">
     Define the workflow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#submit-the-workflow">
     Submit the workflow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyzing-the-results">
     Analyzing the results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#next-steps">
     Next steps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#troubleshooting-and-faq">
   Troubleshooting and FAQ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#my-job-failed">
     My job failed!
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#i-honestly-tried-everything-i-can-to-solve-my-problem-i-still-need-help">
     I honestly tried everything I can to solve my problem. I still need help!
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="installation">
<span id="installation-tutorial"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This guide will get you up and running in an environment for running high-throughput
workflows with atomate2. atomate2 is built on the pymatgen, custodian, jobflow, and
FireWorks libraries. Briefly:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://pymatgen.org">pymatgen</a> is used create input files and analyze the output of materials science codes.</p></li>
<li><p><a class="reference external" href="https://materialsproject.github.io/custodian/">custodian</a> runs your simulation code (e.g., VASP) and performs error checking/handling
and checkpointing.</p></li>
<li><p><a class="reference external" href="https://materialsproject.github.io/jobflow/">jobflow</a> is used to design computational workflows.</p></li>
<li><p><a class="reference external" href="https://materialsproject.github.io/fireworks/">FireWorks</a> (optional) is used to manage and execute workflows on HPC machines.</p></li>
</ul>
<p>Running and writing your own workflows are covered in later tutorials. For now, these
topics will be covered in enough depth to get you set up and to help you know where to
troubleshoot if you’re having problems.</p>
<p>Note that this installation tutorial is VASP-centric since almost all functionality
currently in atomate2 pertains to VASP.</p>
<section id="objectives">
<h3>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Install and configure atomate2 on your computing cluster.</p></li>
<li><p>Validate the installation with a test workflow.</p></li>
</ul>
</section>
<section id="installation-checklist">
<h3>Installation checklist<a class="headerlink" href="#installation-checklist" title="Permalink to this headline">¶</a></h3>
<p>Completing everything on this checklist should result in a fully functioning
environment.</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#prerequisites">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#create-a-directory-scaffold-for-atomate2">Create a directory scaffold for atomate2</a></p></li>
<li><p><a class="reference internal" href="#create-a-conda-environment">Create a conda environment</a></p></li>
<li><p><a class="reference internal" href="#install-python-packages">Install Python packages</a></p></li>
<li><p><a class="reference internal" href="#configure-jobflow">Configure jobflow</a></p></li>
<li><p><a class="reference internal" href="#configure-pymatgen">Configure pymatgen</a></p></li>
<li><p><a class="reference internal" href="#run-a-test-workflow">Run a test workflow</a></p></li>
</ol>
</section>
</section>
<section id="prerequisites">
<span id="id1"></span><h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before you install, you need to make sure that your “worker” computer (where the
simulations will be run, often a computing cluster) that will execute workflows can
(i) run the base simulation packages (e.g., VASP, LAMMPs, FEFF, etc) and (ii) connect
to a MongoDB database. For (i), make sure you have the appropriate licenses and
compilation to run the simulation packages that are needed. For (ii), make sure your
computing center doesn’t have firewalls that prevent database access. Typically,
academic computing clusters as well as systems with a MOM-node style architecture
(e.g., NERSC) are OK.</p>
<section id="vasp">
<h3>VASP<a class="headerlink" href="#vasp" title="Permalink to this headline">¶</a></h3>
<p>To get access to VASP on supercomputing resources typically requires that you’re added
to a user group on the system you work on after your license is verified. Ensure that
you have access to the VASP executable and that it is functional before starting this
tutorial.</p>
</section>
<section id="mongodb">
<h3>MongoDB<a class="headerlink" href="#mongodb" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://docs.mongodb.com/manual/">MongoDB</a> is a NoSQL database that stores each database entry as a document, which is
represented in the JSON format (the formatting is similar to a dictionary in Python).
Atomate2 uses MongoDB to:</p>
<ul class="simple">
<li><p>Create a database of calculation results.</p></li>
<li><p>Store the workflows that you want to run as well as their state details (through
FireWorks - optional).</p></li>
</ul>
<p>MongoDB must be running and available to accept connections whenever you’re running
workflows. Thus, it is strongly recommended that you have a server to run MongoDB or
(simpler) use a hosting service. Your options are:</p>
<ul class="simple">
<li><p>Use a commercial service to host your MongoDB instance. These are typically the
easiest to use and offer high quality service but require payment for larger
databases. <a class="reference external" href="https://www.mongodb.com/cloud/atlas">MongoDB Atlas</a> offers a free 500 MB
server which is certainly enough to get started for small to medium size projects, and
it is easy to upgrade or migrate your database if you exceed the free allocation.</p></li>
<li><p>Contact your supercomputing center to see if they offer MongoDB hosting (e.g., NERSC
has this, Google “request NERSC MongoDB database”).</p></li>
<li><p>Self-host a MongoDB server.</p></li>
</ul>
<p>If you’re just starting, we suggest the first (with a free plan) or second option
(if available to you). The third option will require you to open up network settings to
accept outside connections properly which can sometimes be tricky.</p>
<p>Next, create a new database and set up an account with admin access. Keep a record of
your credentials - we will configure jobflow to connect to them in a later step. Also
make sure you note down the hostname and port for the MongoDB instance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The computers that perform the calculations must have access to your MongoDB server.
Some computing resources have firewalls blocking connections. Although this is not a
problem for most computing centers that allow such connections (particularly from
MOM-style nodes, e.g. at NERSC, SDSC, etc.), but some of the more security-sensitive
centers (e.g., LLNL, PNNL, ARCHER) will run into issues. If you run into connection
issues later in this tutorial, some options are:</p>
<ul class="simple">
<li><p>Contact your computing center to review their security policy to allow connections
from your MongoDB server (best resolution).</p></li>
<li><p>Host your Mongo database on a machine that you’re able to securely connect to,
e.g. on the supercomputing network itself (ask a system administrator for help).</p></li>
<li><p>Use a proxy service to forward connections from the MongoDB –&gt; login node –&gt;
compute node (you might try, for example, <a class="reference external" href="https://github.com/bakks/mongo-proxy">the mongo-proxy tool</a>).</p></li>
<li><p>Set up an ssh tunnel to forward connections from allowed machines (the tunnel must
be kept alive at all times you’re running workflows).</p></li>
</ul>
</div>
</section>
</section>
<section id="create-a-directory-scaffold-for-atomate2">
<span id="id3"></span><h2>Create a directory scaffold for atomate2<a class="headerlink" href="#create-a-directory-scaffold-for-atomate2" title="Permalink to this headline">¶</a></h2>
<p>Installing atomate2 includes installation of codes, configuration files, and various
binaries and libraries. Thus, it is useful to create a directory structure that
organizes all these items.</p>
<ol class="arabic simple">
<li><p>Log in to the compute cluster and create a directory in a spot on disk that has
relatively fast access from compute nodes <em>and</em> that is only accessible by yourself
or your collaborators. Your environment and configuration files will go here,
including database credentials. We will call this place <code class="docutils literal notranslate"><span class="pre">&lt;&lt;INSTALL_DIR&gt;&gt;</span></code>. A good
name might simply be <code class="docutils literal notranslate"><span class="pre">atomate2</span></code>.</p></li>
<li><p>Now you should scaffold the rest of your <code class="docutils literal notranslate"><span class="pre">&lt;&lt;INSTALL_DIR&gt;&gt;</span></code> for the things we are
going to do next. Create a directories named <code class="docutils literal notranslate"><span class="pre">logs</span></code>, and <code class="docutils literal notranslate"><span class="pre">config</span></code> so your
directory structure looks like:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>atomate2
├── config
└── logs
</pre></div>
</div>
</section>
<section id="create-a-conda-environment">
<span id="id4"></span><h2>Create a conda environment<a class="headerlink" href="#create-a-conda-environment" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure to create a Python 3.7+ environment as recent versions of atomate2 only
support Python 3.7 and higher.</p>
</div>
<p>We highly recommended that you organize your installation of the atomate2 and the other
Python codes using a conda virtual environment. Some of the main benefits are:</p>
<ul class="simple">
<li><p>Different Python projects that have conflicting packages can coexist on the same
machine.</p></li>
<li><p>Different versions of Python can exist on the same machine and be managed more easily
(e.g. Python 2 and Python 3).</p></li>
<li><p>You have full rights and control over the environment. On computing resources,
this solves permissions issues with installing and modifying packages.</p></li>
</ul>
<p>The easiest way to get a Python virtual environment is to use the <code class="docutils literal notranslate"><span class="pre">conda</span></code> tool.
Most clusters (e.g., NESRC) have <a class="reference external" href="https://www.continuum.io">Anaconda</a> installed already which provides access to
the <code class="docutils literal notranslate"><span class="pre">conda</span></code> binary. If the <code class="docutils literal notranslate"><span class="pre">conda</span></code> tool is not available, you can install it by
following the installation instructions for <a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a>. To set up your conda
environment:</p>
<ol class="arabic simple">
<li><p>Create a new conda environment called atomate2 with Python 3.9 using
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">create</span> <span class="pre">-n</span> <span class="pre">atomate2</span> <span class="pre">python=3.9</span></code>.</p></li>
<li><p>Activate your environment by running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">atomate2</span></code>. Now, when you use
the command <code class="docutils literal notranslate"><span class="pre">python</span></code>, you’ll be using the version of <code class="docutils literal notranslate"><span class="pre">python</span></code> in the atomate2
conda environment folder.</p></li>
<li><p>Consider adding <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">atomate2</span></code> to your .bashrc or .bash_profile file so
that it is run whenever you log in. Otherwise, note that you must call this command
after every log in before you can do work on your atomate project.</p></li>
</ol>
</section>
<section id="install-python-packages">
<span id="id5"></span><h2>Install Python packages<a class="headerlink" href="#install-python-packages" title="Permalink to this headline">¶</a></h2>
<p>Next, we will download and install all of the atomate2-related Python packages.</p>
<p>To install the packages run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">atomate2</span>
</pre></div>
</div>
</section>
<section id="configure-calculation-output-database">
<span id="configure-jobflow"></span><h2>Configure calculation output database<a class="headerlink" href="#configure-calculation-output-database" title="Permalink to this headline">¶</a></h2>
<p>The next step is to configure your mongoDB database that will be used to store
calculation outputs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of the paths here must be <em>absolute paths</em>. For example, the absolute path that
refers to <code class="docutils literal notranslate"><span class="pre">&lt;&lt;INSTALL_DIR&gt;&gt;</span></code> might be <code class="docutils literal notranslate"><span class="pre">/global/homes/u/username/atomate</span></code> (don’t
use the relative directory <code class="docutils literal notranslate"><span class="pre">~/atomate</span></code>).</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Passwords will be stored in plain text!</strong> These files should be stored in a place
that is not accessible by unauthorized users. Also, you should make random passwords
that are unique only to these databases.</p>
</div>
<p>Create the following files in <code class="docutils literal notranslate"><span class="pre">&lt;&lt;INSTALL_DIR&gt;&gt;/config</span></code>.</p>
<section id="jobflow-yaml">
<h3>jobflow.yaml<a class="headerlink" href="#jobflow-yaml" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">jobflow.yaml</span></code> file contains the credentials of the MongoDB server that will store
calculation outputs. The <code class="docutils literal notranslate"><span class="pre">jobflow.yaml</span></code> file requires you to enter the basic database
information as well as what to call the main collection that results are kept in (e.g.
<code class="docutils literal notranslate"><span class="pre">ouputs</span></code>). Note that you should replace the whole <code class="docutils literal notranslate"><span class="pre">&lt;&lt;PROPERTY&gt;&gt;</span></code> definition with
your own settings.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">JOB_STORE</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">docs_store</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MongoStore</span><span class="w"></span>
<span class="w">      </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;DB_NAME&gt;&gt;</span><span class="w"></span>
<span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;HOSTNAME&gt;&gt;</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;PORT&gt;&gt;</span><span class="w"></span>
<span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;USERNAME&gt;&gt;</span><span class="w"></span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;PASSWORD&gt;&gt;</span><span class="w"></span>
<span class="w">      </span><span class="nt">collection_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="w"></span>
<span class="w">    </span><span class="nt">additional_stores</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GridFSStore</span><span class="w"></span>
<span class="w">        </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;DB_NAME&gt;&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;HOSTNAME&gt;&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;PORT&gt;&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;USERNAME&gt;&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;PASSWORD&gt;&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">collection_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outputs_blobs</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re using a mongoDB hosted on Atlas (using the free plan linked above) the
connection format is slightly different. Instead your <code class="docutils literal notranslate"><span class="pre">jobflow.yaml</span></code> file should
contain the following.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">JOB_STORE</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">docs_store</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MongoURIStore</span><span class="w"></span>
<span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb+srv://&lt;&lt;USERNAME&gt;&gt;:&lt;&lt;PASSWORD&gt;&gt;@&lt;&lt;HOST&gt;&gt;/&lt;&lt;DB_NAME&gt;&gt;?retryWrites=true&amp;w=majority</span><span class="w"></span>
<span class="w">      </span><span class="nt">collection_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="w"></span>
<span class="w">    </span><span class="nt">additional_stores</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GridFSURIStore</span><span class="w"></span>
<span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb+srv://&lt;&lt;USERNAME&gt;&gt;:&lt;&lt;PASSWORD&gt;&gt;@&lt;&lt;HOST&gt;&gt;/&lt;&lt;DB_NAME&gt;&gt;?retryWrites=true&amp;w=majority</span><span class="w"></span>
<span class="w">        </span><span class="nt">collection_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outputs_blobs</span><span class="w"></span>
</pre></div>
</div>
<p>The URI key may be different based on the Atlas database you deployed. You can
see the template for the URI string by clicking on “Databases” (under “Deployment”
in the left hand menu) then “Connect” then “Connect your application”. Select
Python as the driver and 3.12 as the version. The connection string should now be
displayed in the box.</p>
<p>Note that the username and password are not your login account details for Atlas.
Instead you must add a new database user by selecting “Database Access” (under
“Security” in the left hand menu) and then “Add a new database user”.</p>
<p>Secondly, Atlas only allows connections from known IP addresses. You must therefore
add the IP address of your cluster (and any other computers you’ll be connecting
from) by clicking “Network Access” (under “Security” in the left hand menu) and then
“Add IP address”.</p>
</div>
<p>Atomate2 uses two database collections, one for small documents (such as elastic
tensors, structures, and energies) called the <code class="docutils literal notranslate"><span class="pre">docs</span></code> store and another for large
documents such as band structures and density of states called the <code class="docutils literal notranslate"><span class="pre">data</span></code> store.</p>
<p>Due to inherent limitations in MongoDB (individual documents cannot be larger than 16
Mb), we use GridFS to store large data. GridFS sits on top of MongoDB and
therefore doesn’t require any further configuration on your part. However, other
storage types are available (such as Amazon S3). For more information please read
<span class="xref std std-ref">advanced_storage</span>.</p>
</section>
<section id="atomate2-yaml">
<h3>atomate2.yaml<a class="headerlink" href="#atomate2-yaml" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">atomate2.yaml</span></code> file controls all atomate2 settings. You can see the full list
of available settings in the <a class="reference internal" href="../reference/atomate2.settings.Atomate2Settings.html#atomate2.settings.Atomate2Settings" title="atomate2.settings.Atomate2Settings"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Atomate2Settings</span></code></a>. docs. For now, we will just
configure the commands used to run VASP.</p>
<p>Write the <code class="docutils literal notranslate"><span class="pre">atomate2.yaml</span></code> file with the following content,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VASP_CMD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;VASP_CMD&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>The is the command that you would use to run VASP with parallelization
(<code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">-n</span> <span class="pre">16</span> <span class="pre">vasp</span></code>, <code class="docutils literal notranslate"><span class="pre">ibrun</span> <span class="pre">-n</span> <span class="pre">16</span> <span class="pre">vasp</span></code>, <code class="docutils literal notranslate"><span class="pre">mpirun</span> <span class="pre">-n</span> <span class="pre">16</span> <span class="pre">vasp</span></code>, …).</p>
</section>
<section id="finishing-up">
<h3>Finishing up<a class="headerlink" href="#finishing-up" title="Permalink to this headline">¶</a></h3>
<p>The directory structure of <code class="docutils literal notranslate"><span class="pre">&lt;&lt;INSTALL_DIR&gt;&gt;/config</span></code> should now look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>config
├── jobflow.yaml
└── atomate2.yaml
</pre></div>
</div>
<p>The last thing we need to do to configure atomate2 is add the following lines to your
.bashrc / .bash_profile file to set an environment variable telling atomate2 and jobflow
where to find the config files.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ATOMATE2_CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;&lt;&lt;INSTALL_DIR&gt;&gt;/config/atomate2.yaml&quot;</span>
<span class="nb">export</span> <span class="nv">JOBFLOW_CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;&lt;&lt;INSTALL_DIR&gt;&gt;/config/jobflow.yaml&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;&lt;INSTALL_DIR&gt;&gt;</span></code> is your installation directory.</p>
</section>
</section>
<section id="configure-pymatgen">
<span id="id6"></span><h2>Configure pymatgen<a class="headerlink" href="#configure-pymatgen" title="Permalink to this headline">¶</a></h2>
<p>If you’re planning to run VASP, the last configuration step is to configure pymatgen to
(required) find the pseudopotentials for VASP and (optional) set up your API key from
the <a class="reference external" href="https://materialsproject.org/dashboard">Materials Project</a>.</p>
<section id="pseudopotentials">
<h3>Pseudopotentials<a class="headerlink" href="#pseudopotentials" title="Permalink to this headline">¶</a></h3>
<p>The psuedopotentials should be available on the compute machine. Follow the
<a class="reference external" href="https://pymatgen.org/installation.html#potcar-setup">pseudopotential installation instructions in the pymatgen documentation</a>
and then return to this tutorial.</p>
</section>
<section id="materials-project-api-key">
<h3>Materials Project API key<a class="headerlink" href="#materials-project-api-key" title="Permalink to this headline">¶</a></h3>
<p>You can get an API key from the <a class="reference external" href="https://materialsproject.org/dashboard">Materials Project</a> by logging in and going to your
<a class="reference external" href="https://materialsproject.org/dashboard">Dashboard</a>. Add this also to your <code class="docutils literal notranslate"><span class="pre">~/.pmgrc.yaml</span></code> so that it looks like the following</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">PMG_VASP_PSP_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;INSTALL_DIR&gt;&gt;/pps</span><span class="w"></span>
<span class="nt">PMG_MAPI_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;YOUR_API_KEY&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="run-a-test-workflow">
<span id="id7"></span><h2>Run a test workflow<a class="headerlink" href="#run-a-test-workflow" title="Permalink to this headline">¶</a></h2>
<p>To make sure that everything is set up correctly and in place, we’ll finally run a
simple (but real) test workflow. We will first define a python script to run the
workflow. Next, we’ll submit a job to run the script. Finally, we’ll examine the
database to check the job output. In this tutorial, we will be submitting an individual
workflow manually. If you want to manage and execute many workflows simultaneously
this can be achieved using the FireWorks package and is covered in
<a class="reference internal" href="fireworks.html#atomate2-fireworks"><span class="std std-ref">Using atomate2 with FireWorks</span></a>.</p>
<p>This particular workflow will only run a single calculation that optimizes a crystal
structure (not very exciting). In the subsequent tutorials, we’ll run more complex
workflows.</p>
<section id="define-the-workflow">
<h3>Define the workflow<a class="headerlink" href="#define-the-workflow" title="Permalink to this headline">¶</a></h3>
<p>Workflows are written using the jobflow software. Essentially, individual stages of
a workflow are simple python functions. Jobflow provides a way to connect jobs together
in a natural way. For more details on connecting jobs together see:
<a class="reference internal" href="codes/vasp.html#connecting-vasp-jobs"><span class="std std-ref">Chaining workflows</span></a>.</p>
<p>Go to the directory where you would like your calculations to run (i.e., your scratch
or work directory) and create a file called <code class="docutils literal notranslate"><span class="pre">relax.py</span></code> containing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atomate2.vasp.jobs.core</span> <span class="kn">import</span> <span class="n">RelaxMaker</span>
<span class="kn">from</span> <span class="nn">jobflow</span> <span class="kn">import</span> <span class="n">run_locally</span>
<span class="kn">from</span> <span class="nn">pymatgen.core</span> <span class="kn">import</span> <span class="n">Structure</span>

<span class="c1"># construct an FCC silicon structure</span>
<span class="n">si_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span>
    <span class="n">lattice</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.73</span><span class="p">,</span> <span class="mf">2.73</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.73</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.73</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.73</span><span class="p">,</span> <span class="mf">2.73</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
    <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">],</span>
    <span class="n">coords</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]],</span>
<span class="p">)</span>

<span class="c1"># make a relax job to optimise the structure</span>
<span class="n">relax_job</span> <span class="o">=</span> <span class="n">RelaxMaker</span><span class="p">()</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">si_structure</span><span class="p">)</span>

<span class="c1"># run the job</span>
<span class="n">run_locally</span><span class="p">(</span><span class="n">relax_job</span><span class="p">,</span> <span class="n">create_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_locally</span></code> function is a jobflow command that will execute the workflow on
the current computing resource.</p>
</section>
<section id="submit-the-workflow">
<h3>Submit the workflow<a class="headerlink" href="#submit-the-workflow" title="Permalink to this headline">¶</a></h3>
<p>Next, make a job submission script called <code class="docutils literal notranslate"><span class="pre">job.sh</span></code> containing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda activate atomate2
python relax.py
</pre></div>
</div>
<p>The job submission script should include all the headers specific to your HPC resource.
For example, if your machine uses the Grid Engine scheduler for submitting and running
jobs, your script would look something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="c1">#$ -N relax_si</span>
<span class="c1">#$ -P my_project</span>
<span class="c1">#$ -l h_rt=1:00:00</span>
<span class="c1">#$ -l mem=4G</span>
<span class="c1">#$ -pe mpi 16</span>
<span class="c1">#$ -cwd</span>

<span class="c1"># ensure you load the modules to run VASP, e.g., module load vasp</span>

conda activate atomate2
python relax.py
</pre></div>
</div>
<p>Finally, submit the job to the queue using the normal scheduler command. For example
on the Grid Engine scheduler, this would be using <code class="docutils literal notranslate"><span class="pre">qsub</span> <span class="pre">job.sh</span></code>.</p>
</section>
<section id="analyzing-the-results">
<h3>Analyzing the results<a class="headerlink" href="#analyzing-the-results" title="Permalink to this headline">¶</a></h3>
<p>Once the job is finished, you can connect to the output database and check the job
output.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jobflow</span> <span class="kn">import</span> <span class="n">SETTINGS</span>

<span class="n">store</span> <span class="o">=</span> <span class="n">SETTINGS</span><span class="o">.</span><span class="n">JOB_STORE</span>

<span class="c1"># connect to the job store</span>
<span class="n">store</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># query the job store</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">query_one</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;output.formula_pretty&quot;</span><span class="p">:</span> <span class="s2">&quot;Si&quot;</span><span class="p">},</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output.output.energy_per_atom&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>We query the database using the mongoDB query language. You can also connect to the
database using graphical tools, such as <a class="reference external" href="https://robomongo.org">Robo3T</a> to explore your results.</p>
<p>The outputs of VASP calculations always have the same set of keys. This structure is
called a schema. You can see the VASP calculation scheme in the <a class="reference internal" href="../reference/atomate2.common.schemas.cclib.TaskDocument.html#atomate2.common.schemas.cclib.TaskDocument" title="atomate2.common.schemas.cclib.TaskDocument"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TaskDocument</span></code></a>
section of the documentation.</p>
</section>
<section id="next-steps">
<h3>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h3>
<p>That’s it! You’ve completed the installation tutorial!</p>
<p>See the following pages for more information on the topics we covered here:</p>
<ul class="simple">
<li><p>To see how to run and customize the existing Workflows in atomate2, try the
<a class="reference internal" href="running-workflows.html#running-workflows"><span class="std std-ref">Running Workflows</span></a> tutorial (suggested next step).</p></li>
<li><p>To see how manage and execute many workflows at once, try the
<a class="reference internal" href="fireworks.html#atomate2-fireworks"><span class="std std-ref">Using atomate2 with FireWorks</span></a> tutorial.</p></li>
</ul>
</section>
</section>
<section id="troubleshooting-and-faq">
<h2>Troubleshooting and FAQ<a class="headerlink" href="#troubleshooting-and-faq" title="Permalink to this headline">¶</a></h2>
<section id="my-job-failed">
<h3>My job failed!<a class="headerlink" href="#my-job-failed" title="Permalink to this headline">¶</a></h3>
<p>Check the job error files in the launch directroy for any errors. Also check the job
standard output for a full log of the workflow executation and to check for a Python
traceback.</p>
</section>
<section id="i-honestly-tried-everything-i-can-to-solve-my-problem-i-still-need-help">
<h3>I honestly tried everything I can to solve my problem. I still need help!<a class="headerlink" href="#i-honestly-tried-everything-i-can-to-solve-my-problem-i-still-need-help" title="Permalink to this headline">¶</a></h3>
<p>There is a support forum for atomate2: <a class="reference external" href="https://discuss.matsci.org/c/atomate">https://discuss.matsci.org/c/atomate</a></p>
</section>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">User Guide</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="running-workflows.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Running Workflows</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, MaterialsProject.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>